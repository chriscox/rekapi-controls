/**
 * Rekapi Controls - UI controls for Rekapi animations. v0.2.0
 *   By Jeremy Kahn - jeremyckahn@gmail.com
 *   https://github.com/jeremyckahn/rekapi-controls
 *
 * Make Rekapi animations interactive and fun.
 * Dependencies: Rekapi (https://github.com/jeremyckahn/rekapi), Underscore.js (https://github.com/documentcloud/underscore), Shifty.js (https://github.com/jeremyckahn/shifty), jQuery (https://github.com/jquery/jquery), jQuery UI (https://github.com/jquery/jquery-ui)
 * MIT Lincense.  This code free to use, modify, distribute and enjoy.
 */
(function(g){function h(a){var b,c,d,e,f;b=a.kapi;c=a.$container.find(".rekapi-scrubber-play");d=a.$container.find(".rekapi-scrubber-pause");e=a.$container.find(".rekapi-scrubber-stop");f=a.$timeline;c.on("click",function(a){a.preventDefault();b.play()});d.on("click",function(a){a.preventDefault();b.pause()});e.on("click",function(a){a.preventDefault();b.stop(!0)});b.bind("onPlayStateChange",function(){a.syncPlayStateButtons()});b.bind("onStop",function(){a.resetScrubber()});b.bind("onFrameRender",
function(){a.updateScrubber()});f.bind("slide",function(c,d){b.pause();a.syncAnimationToPercent(d.value)})}function d(a){var b,c;this.kapi=a;b=e(a.context);c=e(SCRUBBER_TEMPLATE);b.after(c);this.$container=c=b.next();b=c.find(".rekapi-scrubber-timeline");b.slider({step:0.1});this.$timeline=b;this.$timelineHandle=b.find(".ui-slider-handle");c.width(a.canvasWidth());this.syncPlayStateButtons();b.width(a.canvasWidth()-c.find(".rekapi-scrubber").width());h(this);return this}var e;SCRUBBER_TEMPLATE='<div class="rekapi-scrubber-wrapper"><div class="rekapi-scrubber"><a class="rekapi-scrubber-button rekapi-scrubber-play ui-corner-all" href="#"><span class="ui-icon ui-icon-play"></span></a><a class="rekapi-scrubber-button rekapi-scrubber-pause ui-corner-all" href="#"><span class="ui-icon ui-icon-pause"></span></a><div class="rekapi-scrubber-timeline"></div><a class="rekapi-scrubber-button rekapi-scrubber-stop ui-corner-all" href="#"><span class="ui-icon ui-icon-stop"></span></a></div></div>';
if(!jQuery||!Kapi)throw"Rekapi, and jQuery are needed for Rekapi Controls.";e=jQuery;d.prototype.syncPlayStateButtons=function(){var a,b,c;a=this.kapi;b=this.$container.find(".rekapi-scrubber-play");c=this.$container.find(".rekapi-scrubber-pause");a.isPlaying()?(b.css({display:"none"}),c.css({display:"block"})):(b.css({display:"block"}),c.css({display:"none"}));return this};d.prototype.updateScrubber=function(){this.$timeline.slider("value",100*this.kapi.lastPositionRendered())};d.prototype.resetScrubber=
function(){this.$timeline.slider("value",0)};d.prototype.syncAnimationToScrubber=function(){this.syncAnimationToPercent(this.$timeline.slider("value"))};d.prototype.syncAnimationToPercent=function(a){this.syncAnimationToMillisecond(parseInt(a/100*this.kapi._animationLength))};d.prototype.syncAnimationToMillisecond=function(a){var b;b=Tweenable.util.now();this.kapi.render(a);this.kapi._loopTimestamp=b-a;this.kapi._pausedAtTime=b};g.RekapiScrubber=d})(this);
